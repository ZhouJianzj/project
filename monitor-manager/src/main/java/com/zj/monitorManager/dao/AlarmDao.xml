<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zj.monitorManager.dao.AlarmDao">

<!--    插入报警信息，如果sensor_id存在则变为修改-->
    <insert id="insertAlarm" parameterType="com.zj.monitorManager.entity.Alarm">
        insert into
	        t_alarm(sensor_id, currentValue, alarmMsg,isHandled,alarmTime)
        VALUES
            (#{sensorId},#{currentValue},#{alarmMsg},#{isHandled},#{alarmTime})
        on duplicate key update
 	        currentValue=#{currentValue},isHandled=#{isHandled},
                                alarmMsg=#{alarmMsg},alarmTime=now()
    </insert>

    <resultMap id="sensor" type="com.zj.monitorManager.entity.Sensor">
        <id column="id" property="id"/>
        <result column="sensorName" property="sensorName"/>
        <result column="sensorCode" property="sensorCode"/>
        <result column="protocal" property="protocal"/>
        <collection property="sensorModel"  ofType="com.zj.monitorManager.entity.SensorModel">
            <id property="id" column="mid"/>
            <result property="deviceName" column="deviceName"/>
            <result column="deviceType" property="deviceType"/>
            <result column="deviceNumber" property="deviceNumber"/>
            <result column="createTime" property="createTime"/>
            <result column="upInterval" property="upInterval"/>
            <result column="protocol" property="protocol"/>
            <result column="dataPointName" property="dataPointName"/>
            <result column="lowThreshold" property="lowThreshold"/>
            <result column="highThreshold" property="highThreshold"/>
            <result column="dataPointExtra" property="dataPointExtra"/>
        </collection>
    </resultMap>
    <select id="selectSensor" resultMap="sensor">
        select s.id,
               s.sensorName,
               s.sensorModel_id,
               sm.id as mid,
               sm.deviceType,
               sm.dataPointName,
               sm.lowThreshold,
               sm.highThreshold
        from t_sensor s left join t_sensor_model sm on sm.id = s.sensorModel_id
    </select>

    <select id="selectSensorModelById" resultType="com.zj.monitorManager.entity.SensorModel">
        select * from t_sensor_model where id = #{sensorModelId}
    </select>
</mapper>