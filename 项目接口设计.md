#  一、系统管理

## 1. 机构管理

### a. 查询机构

1. 简要描述

   查询所有机构或单个机构

2. 请求url

   ```
   175.27.245.91/sys/org?pageNo=1&&key=建筑
   ```

3. 请求方式

   get

4. 参数

   | 参数名 | 必选 | 类型   | 说明       |
   | ------ | ---- | ------ | ---------- |
   | pageNo | 是   | int    | 分页的页码 |
   | key    | 否   | String | 查询关键字 |

5. 返回示例

   ```json
   {
       "success": true,
       "msg": null,
       "obj": {
           "total": 2,
           "list": [
               {
                   "id": 2,
                   "name": "北京地铁公司",
                   "parentOrga": {
                       "id": 1,
                       "name": "南京煤业有限公司",
                       "parentOrga": null,
                       "orgaType": null,
                       "location": null,
                       "orga_number": null,
                       "ext": null
                   },
                   "orgaType": {
                       "id": 2,
                       "name": "建筑"
                   },
                   "location": "北京西直门",
                   "orga_number": "10039",
                   "ext": null
               },
               {
                   "id": 1,
                   "name": "南京煤业有限公司",
                   "parentOrga": null,
                   "orgaType": {
                       "id": 1,
                       "name": "矿业"
                   },
                   "location": "南京雨花",
                   "orga_number": "13339",
                   "ext": null
               }
           ],
           "pageNum": 1,
           "pageSize": 2,
           "size": 2,
           "startRow": 1,
           "endRow": 2,
           "pages": 1,
           "prePage": 0,
           "nextPage": 0,
           "isFirstPage": true,
           "isLastPage": true,
           "hasPreviousPage": false,
           "hasNextPage": false,
           "navigatePages": 8,
           "navigatepageNums": [
               1
           ],
           "navigateFirstPage": 1,
           "navigateLastPage": 1,
           "lastPage": 1,
           "firstPage": 1
       }
   }
   ```

6. 返回参数说明

   | 字段名  | 类型     | 说明                       |
   | ------- | -------- | -------------------------- |
   | success | boolean  | 操作成功为true,失败为false |
   | msg     | String   | 用来记录操作的错误提示     |
   | obj     | PageInfo | 分页对象                   |

7. 备注

   后面如果没有特殊说明，后面所有接口返回值类型都是同上





### b. 添加机构



1. 简要描述

   添加单个机构

2. 请求url

   ```
   175.27.245.91/sys/org
   ```

3. 请求方式

   post

4. 参数

   | 参数名 | 必选 | 类型 | 说明                                     |
   | ------ | ---- | ---- | ---------------------------------------- |
   | o      | 是   | Orga | 前端传JSON对象，后端使用@RequestBody接收 |

   

5. 参数示例

   ```json
   {
   "name":"江东集团", 
   "parentOrga":{"id":"1"},
   "orgaType":{"id":"2"},
   "location":"江东南昌",
   "orga_number":"test",
   "ext":"bbbb"
   }
   ```

   

6. 返回示例

   ```json
   {
       "success": true,
       "msg": "添加成功",
       "obj": null
   }
   ```

7. 返回参数说明

   | 字段名  | 类型    | 说明                       |
   | ------- | ------- | -------------------------- |
   | success | boolean | 操作成功为true,失败为false |
   | msg     | String  | 用来记录操作是否成功的提示 |



##2. 角色管理



### a. 查询角色

1. 简要描述

   分页查询所有角色或指定角色

2. 请求url

   ```
   175.27.245.91/sys/role/{参数1}/{参数2}
   ```

3. 请求方式

   get

4. 参数

   | 参数名   | 必选 | 类型   | 说明              |
   | -------- | ---- | ------ | ----------------- |
   | pageNo   | 是   | int    | 参数1，分页的页码 |
   | roleName | 否   | String | 参数2，查询关键字 |

5. 返回示例

   ```json
   {
       "success": true,
       "msg": null,
       "obj": {
           "total": 3,
           "list": [
               {
                   "id": 1,
                   "name": "superManager",
                   "ext": "超级管理员",
                   "perms": null
               },
               {
                   "id": 2,
                   "name": "userManager",
                   "ext": "普通管理员",
                   "perms": null
               }
           ],
           "pageNum": 1,
           "pageSize": 2,
           "size": 2,
           "startRow": 1,
           "endRow": 2,
           "pages": 2,
           "prePage": 0,
           "nextPage": 2,
           "isFirstPage": true,
           "isLastPage": false,
           "hasPreviousPage": false,
           "hasNextPage": true,
           "navigatePages": 8,
           "navigatepageNums": [
               1,
               2
           ],
           "navigateFirstPage": 1,
           "navigateLastPage": 2,
           "lastPage": 2,
           "firstPage": 1
       }
   }
   ```

6. 返回参数说明

   | 字段名  | 类型     | 说明                       |
   | ------- | -------- | -------------------------- |
   | success | boolean  | 操作成功为true,失败为false |
   | msg     | String   | 用来记录操作的错误提示     |
   | obj     | PageInfo | 分页对象                   |

   


### b. 添加角色

1. 简要描述

   添加单个角色

2. 请求url

   ```
   175.27.245.91/sys/role
   ```

3. 请求方式

   post

4. 参数

   | 参数名 | 必选 | 类型 | 说明                                     |
   | ------ | ---- | ---- | ---------------------------------------- |
   | r      | 是   | Role | 前端传JSON对象，后端使用@RequestBody接收 |

   

5. 参数示例

   ```json
   {
       "name":"productManager",
       "ext":"销售业务员，负责销售执行"
   }
   ```

   

6. 返回示例

   ```json
   {
       "success": true,
       "msg": "添加成功",
       "obj": null
   }
   ```

7. 返回参数说明

   | 字段名  | 类型    | 说明                       |
   | ------- | ------- | -------------------------- |
   | success | boolean | 操作成功为true,失败为false |
   | msg     | String  | 用来记录操作是否成功的提示 |



### c. 删除角色



1. 简要描述

   删除单个角色

2. 请求url

   ```
   175.27.245.91/sys/role/{角色id}
   ```

3. 请求方式

   delete

4. 参数

   | 参数名 | 必选 | 类型    | 说明                |
   | ------ | ---- | ------- | ------------------- |
   | id     | 是   | Integer | 直接在url上拼接参数 |

5. 返回示例

   ```json
   {
       "success": true,
       "msg": "删除成功",
       "obj": null
   }
   ```

6. 返回参数说明

   | 字段名  | 类型    | 说明                       |
   | ------- | ------- | -------------------------- |
   | success | boolean | 操作成功为true,失败为false |
   | msg     | String  | 用来记录操作是否成功的提示 |



### d. 查询所有权限

1. 简要描述

   **不分页**查询所有权限

2. 请求url

   ```
   175.27.245.91/sys/perms
   ```

3. 请求方式

   get

4. 参数

   无参数

5. 返回示例

   ```json
   {
       "success": true,
       "msg": null,
       "obj": [
           {
               "id": 1,
               "name": "sys:*:*",
               "ext": null
           },
           {
               "id": 2,
               "name": "work:*:*",
               "ext": null
           },
           {
               "id": 3,
               "name": "model:*:*",
               "ext": null
           }
       ]
   }
   ```

6. 返回参数说明

   | 字段名  | 类型    | 说明                       |
   | ------- | ------- | -------------------------- |
   | success | boolean | 操作成功为true,失败为false |
   | msg     | String  | 用来记录操作的错误提示     |
   | obj     | List    | 分页对象                   |



### e. 给角色添加权限

1. 简要描述

   向指定角色中添加权限

2. 请求url

   ```
   175.27.245.91/sys/role/perm/{角色id}/{权限id}
   ```

3. 请求方式

   post

4. 参数

   | 参数名  | 必选 | 类型    | 说明                  |
   | ------- | ---- | ------- | --------------------- |
   | role_id | 是   | Integer | 参数1,直接拼接在url上 |
   | perm_id | 是   | Integer | 参数2,直接拼接在url上 |

   

5. 返回示例

   ```json
   {
       "success": true,
       "msg": "给角色添加权限成功",
       "obj": null
   }
   ```

6. 返回参数说明

   | 字段名  | 类型    | 说明                       |
   | ------- | ------- | -------------------------- |
   | success | boolean | 操作成功为true,失败为false |
   | msg     | String  | 用来记录操作是否成功的提示 |

## 3. 用户管理

### a. 查询用户

1. 简要描述

   查询所有用户或根据关键字查询

2. 请求url

   ```
   175.27.245.91/sys/user?pageNo=1&&key=13999999913
   ```

3. 请求方式

   get

4. 参数

   | 参数名 | 必选 | 类型   | 说明                                      |
   | ------ | ---- | ------ | ----------------------------------------- |
   | pageNo | 是   | int    | 分页的页码                                |
   | key    | 否   | String | 查询关键字,会从用户名和手机号两个字段查询 |

5. 返回示例

   ```json
   {
       "success": true,
       "msg": null,
       "obj": {
           "total": 4,
           "list": [
               {
                   "id": 1,
                   "username": "a1",
                   "password": "123",
                   "salt": null,
                   "phone": "13999999912",
                   "roles": [
                       {
                           "id": 1,
                           "name": "superManager",
                           "ext": "超级管理员",
                           "perms": null
                       }
                   ],
                   "o": {
                       "id": 1,
                       "name": "南京煤业有限公司",
                       "parentOrga": null,
                       "orgaType": null,
                       "location": null,
                       "orga_number": null,
                       "ext": null
                   }
               },
               {
                   "id": 2,
                   "username": "a2",
                   "password": "456",
                   "salt": null,
                   "phone": "13899999912",
                   "roles": [
                       {
                           "id": 2,
                           "name": "userManager",
                           "ext": "普通管理员",
                           "perms": null
                       }
                   ],
                   "o": {
                       "id": 2,
                       "name": "北京地铁公司",
                       "parentOrga": null,
                       "orgaType": null,
                       "location": null,
                       "orga_number": null,
                       "ext": null
                   }
               }
           ],
           "pageNum": 1,
           "pageSize": 2,
           "size": 2,
           "startRow": 1,
           "endRow": 2,
           "pages": 2,
           "prePage": 0,
           "nextPage": 2,
           "isFirstPage": true,
           "isLastPage": false,
           "hasPreviousPage": false,
           "hasNextPage": true,
           "navigatePages": 8,
           "navigatepageNums": [
               1,
               2
           ],
           "navigateFirstPage": 1,
           "navigateLastPage": 2,
           "lastPage": 2,
           "firstPage": 1
       }
   }
   ```

6. 返回参数说明

   | 字段名  | 类型     | 说明                       |
   | ------- | -------- | -------------------------- |
   | success | boolean  | 操作成功为true,失败为false |
   | msg     | String   | 用来记录操作的错误提示     |
   | obj     | PageInfo | 分页对象                   |

### b. 添加用户

1. 简要描述

   添加单个用户

2. 请求url

   ```
   175.27.245.91/sys/user
   ```

3. 请求方式

   post

4. 参数

   | 参数名 | 必选 | 类型        | 说明                                     |
   | ------ | ---- | ----------- | ---------------------------------------- |
   | r      | 是   | UserManager | 前端传JSON对象，后端使用@RequestBody接收 |

   

5. 参数示例

   ```json
   {
     "username":"hello2",
     "password":"123",
     "salt":"hello11",
     "phone":"13911111100"
   }
   ```

   

6. 返回示例

   ```json
   {
       "success": true,
       "msg": "添加成功",
       "obj": null
   }
   ```

7. 返回参数说明

   | 字段名  | 类型    | 说明                       |
   | ------- | ------- | -------------------------- |
   | success | boolean | 操作成功为true,失败为false |
   | msg     | String  | 用来记录操作是否成功的提示 |

### c. 删除用户

1. 简要描述

   删除单个用户

2. 请求url

   ```
   175.27.245.91/sys/user/{用户id}
   ```

3. 请求方式

   delete

4. 参数

   | 参数名 | 必选 | 类型 | 说明                                    |
   | ------ | ---- | ---- | --------------------------------------- |
   | userId | 是   | int  | url传参数，后端使用pathVariable接受参数 |

   

5. 返回示例

   ```json
   {
       "success": true,
       "msg": "删除成功",
       "obj": null
   }
   ```

6. 返回参数说明

   | 字段名  | 类型    | 说明                       |
   | ------- | ------- | -------------------------- |
   | success | boolean | 操作成功为true,失败为false |
   | msg     | String  | 用来记录操作是否成功的提示 |

### d. 查询单个用户



2. 请求url

   ```
   175.27.245.91/sys/user/{user_id}
   ```

3. 请求方式

   get

4. 参数

   | 参数名  | 必选 | 类型 | 说明   |
   | ------- | ---- | ---- | ------ |
   | user_id | 是   | int  | 用户id |

5. 返回示例

   ```json
   {
       "success": true,
       "msg": "查询成功",
       "obj": {
           "id": 2,
           "username": "a2",
           "password": "456",
           "salt": null,
           "phone": "13899999912",
           "roles": [
               {
                   "id": 2,
                   "name": null,
                   "ext": "普通管理员",
                   "perms": null
               },
               {
                   "id": 3,
                   "name": null,
                   "ext": "安装工人",
                   "perms": null
               }
           ],
           "o": {
               "id": 2,
               "name": "北京地铁公司",
               "parentOrga": null,
               "orgaType": null,
               "location": null,
               "orga_number": null,
               "ext": null
           }
       }
   }
   ```

6. 返回参数说明

   | 字段名  | 类型        | 说明                       |
   | ------- | ----------- | -------------------------- |
   | success | boolean     | 操作成功为true,失败为false |
   | msg     | String      | 用来记录操作的错误提示     |
   | obj     | UserManager | 用户对象                   |

### e. 用户登录

1. 请求url

   ```
   175.27.245.91/sys/login?username=a1&&password=123
   ```

2. 请求方式

   get

3. 参数

   | 参数名      | 必选 | 类型        | 说明         |
   | ----------- | ---- | ----------- | ------------ |
   | userManager | 是   | UserManager | 表单提交数据 |

4. 返回示例

   ```json
   {
       "success": true,
       "msg": "登录成功",
       "obj": {
           "id": 1,
           "username": "a1",
           "password": "123",
           "salt": null,
           "phone": "13999999912",
           "roles": [
               {
                   "id": 1,
                   "name": "superManager",
                   "ext": "超级管理员",
                   "perms": [
                       {
                           "id": 1,
                           "name": "sys:*:*",
                           "ext": null
                       },
                       {
                           "id": 2,
                           "name": "work:*:*",
                           "ext": null
                       },
                       {
                           "id": 3,
                           "name": "model:*:*",
                           "ext": null
                       }
                   ]
               }
           ],
           "o": {
               "id": 1,
               "name": "南京煤业有限公司",
               "parentOrga": null,
               "orgaType": null,
               "location": null,
               "orga_number": null,
               "ext": null
           }
       }
   }
   ```

5. 返回参数说明

   | 字段名  | 类型        | 说明                       |
   | ------- | ----------- | -------------------------- |
   | success | boolean     | 操作成功为true,失败为false |
   | msg     | String      | 用来记录操作的错误提示     |
   | obj     | UserManager | 用户对象                   |



## 4. 日志管理

### a. 查询日志

1. 简要描述

   查询所有日志或根据关键字查询

2. 请求url

   ```
   175.27.245.91/sys/log?pageNo=1&&key=a1
   ```

3. 请求方式

   get

4. 参数

   | 参数名 | 必选 | 类型   | 说明                        |
   | ------ | ---- | ------ | --------------------------- |
   | pageNo | 是   | int    | 分页的页码                  |
   | key    | 否   | String | 查询关键字,会从多个字段查询 |

5. 返回示例

   ```json
   {
       "success": true,
       "msg": null,
       "obj": {
           "total": 3,
           "list": [
               {
                   "id": 1,
                   "username": "a1",
                   "operType": "add",
                   "moduleName": "orga",
                   "result": true,
                   "operTime": "2021-09-24T07:53:15.000+0000",
                   "operContent": "添加组织"
               },
               {
                   "id": 2,
                   "username": "a1",
                   "operType": "add",
                   "moduleName": "role",
                   "result": true,
                   "operTime": "2021-09-24T08:06:23.000+0000",
                   "operContent": "添加角色"
               }
           ],
           "pageNum": 1,
           "pageSize": 2,
           "size": 2,
           "startRow": 1,
           "endRow": 2,
           "pages": 2,
           "prePage": 0,
           "nextPage": 2,
           "isFirstPage": true,
           "isLastPage": false,
           "hasPreviousPage": false,
           "hasNextPage": true,
           "navigatePages": 8,
           "navigatepageNums": [
               1,
               2
           ],
           "navigateFirstPage": 1,
           "navigateLastPage": 2,
           "lastPage": 2,
           "firstPage": 1
       }
   }
   ```

6. 返回参数说明

   | 字段名  | 类型     | 说明                       |
   | ------- | -------- | -------------------------- |
   | success | boolean  | 操作成功为true,失败为false |
   | msg     | String   | 用来记录操作的错误提示     |
   | obj     | PageInfo | 分页对象                   |

# 二、项目管理

## 1. 查询项目

1. 简要描述

   查询所有项目或根据关键字查询

2. 请求url

   ```
   175.27.245.91/item/item?key=key&&pageNo=1
   ```

3. 请求方式

   get

4. 参数

   | 参数名 | 必选 | 类型   | 说明                        |
   | ------ | ---- | ------ | --------------------------- |
   | pageNo | 是   | int    | 分页的页码                  |
   | key    | 否   | String | 查询关键字,会从多个字段查询 |

5. 返回示例

   ```json
   {
       "success": true,
       "msg": null,
       "obj": {
           "total": 1,
           "list": [
               {
                   "id": 1,
                   "name": "神话一号项目",
                   "number": "饿泥豆腐",
                   "o": {
                       "id": 1,
                       "name": "南京煤业有限公司",
                       "parentOrga": null,
                       "orgaType": null,
                       "location": null,
                       "orga_number": null,
                       "ext": null
                   },
                   "addr": "南天门33重天",
                   "phone": "16887667811",
                   "createTime": "2021-09-30T06:29:48.000+0000"
               }
           ],
           "pageNum": 1,
           "pageSize": 2,
           "size": 1,
           "startRow": 1,
           "endRow": 1,
           "pages": 1,
           "prePage": 0,
           "nextPage": 0,
           "isFirstPage": true,
           "isLastPage": true,
           "hasPreviousPage": false,
           "hasNextPage": false,
           "navigatePages": 8,
           "navigatepageNums": [
               1
           ],
           "navigateFirstPage": 1,
           "navigateLastPage": 1,
           "lastPage": 1,
           "firstPage": 1
       }
   }
   ```

6. 返回参数说明

   | 字段名  | 类型     | 说明                       |
   | ------- | -------- | -------------------------- |
   | success | boolean  | 操作成功为true,失败为false |
   | msg     | String   | 用来记录操作的错误提示     |
   | obj     | PageInfo | 分页对象                   |

## 2. 添加项目

1. 简要描述

   添加单个项目

2. 请求url

   ```
   175.27.245.91/item/item
   ```

3. 请求方式

   post

4. 参数

   | 参数名 | 必选 | 类型 | 说明                                     |
   | ------ | ---- | ---- | ---------------------------------------- |
   | r      | 是   | Item | 前端传JSON对象，后端使用@RequestBody接收 |

   

5. 参数示例

   ```json
   {
       "name":"神游太虚",
       "number":"008",
       "addr":"太虚宫",
       "phone":"13999999999",
       "o":{"id":"1"}
   }
   ```

   

6. 返回示例

   ```json
   {
       "success": true,
       "msg": "添加成功",
       "obj": null
   }
   ```

7. 返回参数说明

   | 字段名  | 类型    | 说明                       |
   | ------- | ------- | -------------------------- |
   | success | boolean | 操作成功为true,失败为false |
   | msg     | String  | 用来记录操作是否成功的提示 |

 







## 3.  删除项目

1. 简要描述

   删除单个项目

2. 请求url

   ```
   175.27.245.91/item/item/{项目id}
   ```

3. 请求方式

   delete

4. 参数

   | 参数名 | 必选 | 类型 | 说明                                    |
   | ------ | ---- | ---- | --------------------------------------- |
   | itemId | 是   | int  | url传参数，后端使用pathVariable接受参数 |

   

5. 返回示例

   ```json
   {
       "success": true,
       "msg": "删除成功",
       "obj": null
   }
   ```

6. 返回参数说明

   | 字段名  | 类型    | 说明                       |
   | ------- | ------- | -------------------------- |
   | success | boolean | 操作成功为true,失败为false |
   | msg     | String  | 用来记录操作是否成功的提示 |

## 4. 修改项目

1. 简要描述

   添加单个项目

2. 请求url

   ```
   175.27.245.91/item/item
   ```

3. 请求方式

   put

4. 参数

   | 参数名 | 必选 | 类型 | 说明                                     |
   | ------ | ---- | ---- | ---------------------------------------- |
   | r      | 是   | Item | 前端传JSON对象，后端使用@RequestBody接收 |

   

5. 参数示例

   ```json
   {
       "id":"7", #注意，id值必须给出
       "name":"神游太清",
       "number":"009",
       "addr":"太虚宫-上清宫",
       "phone":"13999999900",
       "o":{"id":"2"}
   }
   ```

   

6. 返回示例

   ```json
   {
       "success": true,
       "msg": "修改成功",
       "obj": null
   }
   ```

7. 返回参数说明

   | 字段名  | 类型    | 说明                       |
   | ------- | ------- | -------------------------- |
   | success | boolean | 操作成功为true,失败为false |
   | msg     | String  | 用来记录操作是否成功的提示 |

# 三、模型管理

## 1. 文件上传

1. 简要描述

   上传文件

2. 请求url

   ```
   175.27.245.91/model/pipe/upload
   ```

3. 请求方式

   post

4. 参数

   | 参数名 | 必选 | 类型          | 说明                              |
   | ------ | ---- | ------------- | --------------------------------- |
   | file   | 是   | MultipartFile | 前端传multipart/form-data格式数据 |

   

5. 参数示例

   ```json
   在body中添加file类型表单数据，key名为file,value为选择的目标文件
   ```

   

6. 返回示例

   ```json
   {
       "success": true,
       "msg": "Z65Aq",
       "obj": null
   }
   ```

7. 返回参数说明

   | 字段名  | 类型    | 说明                                                         |
   | ------- | ------- | ------------------------------------------------------------ |
   | success | boolean | 操作成功为true,失败为false                                   |
   | msg     | String  | 用来记录文件上传成功后，在后台保存的文件名，重要提示：前端在添加数据时，会优先上传文件，前端获取出msg值保存在前端，在提交添加管道模型数据时，把msg作为文件的名字，一同提交到后台，保存在数据库中。 |

## 2. 管道模型管理

### a. 添加管道模型

1. 简要描述

   添加单个管道模型

2. 请求url

   ```
   175.27.245.91/model/pipe
   ```

3. 请求方式

   post

4. 参数

   | 参数名 | 必选 | 类型              | 说明                                     |
   | ------ | ---- | ----------------- | ---------------------------------------- |
   | p      | 是   | @RequestBody Pipe | 前端传JSON对象，后端使用@RequestBody接收 |

   

5. 参数示例

   ```json
   {
       "pipeName":"管道名1",
       "pipeNumber":"999管道",
       "pipeType":"单波纹",
       "pipeIntroduce":"管道说明书后台名1",
       "pipeManual":"管道手册后台名1",
       "pipePic":"管道图片后台名1"
   }
   ```
   
   
   
6. 返回示例

   ```json
   {
       "success": true,
       "msg": "添加成功",
       "obj": null
   }
   ```

7. 返回参数说明

   | 字段名  | 类型    | 说明                       |
   | ------- | ------- | -------------------------- |
   | success | boolean | 操作成功为true,失败为false |
   | msg     | String  | 用来记录操作是否成功的提示 |

### b. 修改管道模型

1. 简要描述

   修改单个管道模型，这里涉及到管道图片，手册，说明书三项文件上传，如果前端传递过来的数据中，key为pipePic,pipeManual,pipeIntroduce的这三项为空，则认为不修改对应的文件内容。

2. 请求url

   ```
   175.27.245.91/model/pipe
   ```

3. 请求方式

   put

4. 参数

   | 参数名 | 必选 | 类型              | 说明                                     |
   | ------ | ---- | ----------------- | ---------------------------------------- |
   | pipe   | 是   | @RequestBody Pipe | 前端传JSON对象，后端使用@RequestBody接收 |

   

5. 参数示例

   ```json
   {
       "id":"2",
       "pipeName":"管道名031",
       "pipeNumber":"998管道",
       "pipeType":"多波纹",
       "pipeIntroduce":"", #传过来的参数是空字符串或根本就没有这一项，则不修改对应数据
       "pipePic":"图片后台新名字"
   }
   ```
   
   
   
6. 返回示例

   ```json
   {
       "success": true,
       "msg": "修改成功",
       "obj": null
   }
   ```

7. 返回参数说明

   | 字段名  | 类型    | 说明                       |
   | ------- | ------- | -------------------------- |
   | success | boolean | 操作成功为true,失败为false |
   | msg     | String  | 用来记录操作是否成功的提示 |

### c. 删除管道模型

1. 简要描述

   修改单个管道模型，在后台删除管道前，先根据id查询出管道，把相关的三个文件删除后，再从数据库中删除该管道

2. 请求url

   ```
   175.27.245.91/model/pipe/{pipeId}
   ```

3. 请求方式

   put

4. 参数

   | 参数名 | 必选 | 类型    | 说明                              |
   | ------ | ---- | ------- | --------------------------------- |
   | pipeId | 是   | Integer | 后端通过@PathVariable注解接收参数 |

   

5. 参数示例

   ```json
   175.27.245.91/model/pipe/2
   ```

   

6. 返回示例

   ```json
   {
       "success": true,
       "msg": "删除成功",
       "obj": null
   }
   ```

7. 返回参数说明

   | 字段名  | 类型    | 说明                       |
   | ------- | ------- | -------------------------- |
   | success | boolean | 操作成功为true,失败为false |
   | msg     | String  | 用来记录操作是否成功的提示 |

### d. 查询管道模型

1. 简要描述

   查询所有管道模型或根据关键字查询

2. 请求url

   ```
   175.27.245.91/model/pipe?key=key&&pageNo=1
   ```

3. 请求方式

   get

4. 参数

   | 参数名 | 必选 | 类型   | 说明                        |
   | ------ | ---- | ------ | --------------------------- |
   | pageNo | 是   | int    | 分页的页码                  |
   | key    | 否   | String | 查询关键字,会从多个字段查询 |

5. 返回示例

   ```json
   {
       "success": true,
       "msg": null,
       "obj": {
           "total": 2,
           "list": [
               {
                   "id": null,
                   "pipeName": "管道名01",
                   "pipeNumber": "998管道",
                   "pipeType": "多波纹",
                   "pipeIntroduce": "",
                   "pipePic": "图片名1",
                   "pipeManual": "管道手册后台名1",
                   "createTime": null
               },
               {
                   "id": null,
                   "pipeName": "管道名2",
                   "pipeNumber": "9992管道",
                   "pipeType": "单波纹",
                   "pipeIntroduce": "管道说明书后台名2",
                   "pipePic": "Ss222g2",
                   "pipeManual": "管道手册后台名2",
                   "createTime": null
               }
           ],
           "pageNum": 1,
           "pageSize": 2,
           "size": 2,
           "startRow": 1,
           "endRow": 2,
           "pages": 1,
           "prePage": 0,
           "nextPage": 0,
           "isFirstPage": true,
           "isLastPage": true,
           "hasPreviousPage": false,
           "hasNextPage": false,
           "navigatePages": 8,
           "navigatepageNums": [
               1
           ],
           "navigateFirstPage": 1,
           "navigateLastPage": 1,
           "lastPage": 1,
           "firstPage": 1
       }
   }
   ```
   
6. 返回参数说明

   | 字段名  | 类型     | 说明                       |
   | ------- | -------- | -------------------------- |
   | success | boolean  | 操作成功为true,失败为false |
   | msg     | String   | 用来记录操作的错误提示     |
   | obj     | PageInfo | 分页对象                   |

## 3. 传感器模型管理

### a. 添加传感器模型

1. 简要描述

   添加单个传感器模型

2. 请求url

   ```
   175.27.245.91/model/sensor
   ```

3. 请求方式

   post

4. 参数

   | 参数名 | 必选 | 类型                       | 说明                                     |
   | ------ | ---- | -------------------------- | ---------------------------------------- |
   | d      | 是   | @RequestBody Sensor sensor | 前端传JSON对象，后端使用@RequestBody接收 |

   

5. 参数示例

   ```json
   {
       "sensorName":"传感器名1",
       "sensorCode":"传感器编码1",
       "protocal":"传感器协议",
       "sensorModel":{"id":"1"}
   }
   ```
   
   
   
6. 返回示例

   ```json
   {
       "success": true,
       "msg": "添加成功",
       "obj": null
   }
   ```

7. 返回参数说明

   | 字段名  | 类型    | 说明                       |
   | ------- | ------- | -------------------------- |
   | success | boolean | 操作成功为true,失败为false |
   | msg     | String  | 用来记录操作是否成功的提示 |

### b. 修改传感器模型

1. 简要描述

   修改单个传感器模型

2. 请求url

   ```
   175.27.245.91/model/sensor
   ```

3. 请求方式

   put

4. 参数

   | 参数名 | 必选 | 类型                  | 说明                                     |
   | ------ | ---- | --------------------- | ---------------------------------------- |
   | d      | 是   | @RequestBody Sensor s | 前端传JSON对象，后端使用@RequestBody接收 |

   

5. 参数示例

   ```json
   {
       "id":"5",
       "sensorName":"传感器名5",
       "sensorCode":"传感器编码3",
       "protocal":"传感器协议3",
       "scene":{"id":"1"},
       "sensorModel":{"id":"1"}
   }
   ```
   
   
   
6. 返回示例

   ```json
   {
       "success": true,
       "msg": "修改成功",
       "obj": null
   }
   ```

7. 返回参数说明

   | 字段名  | 类型    | 说明                       |
   | ------- | ------- | -------------------------- |
   | success | boolean | 操作成功为true,失败为false |
   | msg     | String  | 用来记录操作是否成功的提示 |

### c. 删除传感器模型

1. 简要描述

   删除单个传感器模型

2. 请求url

   ```
   175.27.245.91/model/sensor/{id}
   ```

3. 请求方式

   delete

4. 参数

   | 参数名 | 必选 | 类型    | 说明                              |
   | ------ | ---- | ------- | --------------------------------- |
   | id     | 是   | Integer | 后端通过@PathVariable注解接收参数 |

   

5. 参数示例

   ```json
   175.27.245.91/model/sensor/1
   ```

   

6. 返回示例

   ```json
   {
       "success": true,
       "msg": "删除成功",
       "obj": null
   }
   ```

7. 返回参数说明

   | 字段名  | 类型    | 说明                       |
   | ------- | ------- | -------------------------- |
   | success | boolean | 操作成功为true,失败为false |
   | msg     | String  | 用来记录操作是否成功的提示 |

### d. 查询传感器模型

1. 简要描述

   查询所有传感器模型或根据关键字查询

2. 请求url

   ```
   175.27.245.91/model/sensor?key=key&&pageNo=1
   ```

3. 请求方式

   get

4. 参数

   | 参数名 | 必选 | 类型   | 说明                        |
   | ------ | ---- | ------ | --------------------------- |
   | pageNo | 是   | int    | 分页的页码                  |
   | key    | 否   | String | 查询关键字,会从多个字段查询 |

5. 返回示例

   ```json
   {
       "success": true,
       "msg": null,
       "obj": {
           "total": 1,
           "list": [
               {
                   "id": 2,
                   "deviceName": "设备名1",
                   "deviceType": "温度传感器",
                   "deviceNumber": "9991设备道",
                   "createTime": null,
                   "protocol": "coap",
                   "upInterval": 30,
                   "dataPointName": "温度",
                   "dataPointExtra": "暂无",
                   "lowThreshold": 50,
                   "highThreshold": 80
               }
           ],
           "pageNum": 1,
           "pageSize": 2,
           "size": 1,
           "startRow": 1,
           "endRow": 1,
           "pages": 1,
           "prePage": 0,
           "nextPage": 0,
           "isFirstPage": true,
           "isLastPage": true,
           "hasPreviousPage": false,
           "hasNextPage": false,
           "navigatePages": 8,
           "navigatepageNums": [
               1
           ],
           "navigateFirstPage": 1,
           "navigateLastPage": 1,
           "firstPage": 1,
           "lastPage": 1
       }
   }
   ```
   
6. 返回参数说明

   | 字段名  | 类型     | 说明                       |
   | ------- | -------- | -------------------------- |
   | success | boolean  | 操作成功为true,失败为false |
   | msg     | String   | 用来记录操作的错误提示     |
   | obj     | PageInfo | 分页对象                   |

## 4. 场景管理

### a. 添加场景

1. 简要描述

   添加单个场景模型，在mapper.xml文件中，使用useGeneratedKeys="true" keyProperty="id"来获取所插入的主键值，然后再把该场景所使用rules一条条的插入到数据库中。

2. 请求url

   ```
   175.27.245.91/model/scene
   ```

3. 请求方式

   post

4. 参数

   | 参数名 | 必选 | 类型                 | 说明                                     |
   | ------ | ---- | -------------------- | ---------------------------------------- |
   | d      | 是   | @RequestBody Scene s | 前端传JSON对象，后端使用@RequestBody接收 |

   

5. 参数示例

   ```json
   {
       "sceneNumber":"场景02",
       "sceneName":"场景名02",
       "alarmTitle":"报警标题02",
       "alarmMsg":"报警消息02",
       "o":{"id":"1"},
       "rules":[
           {
               "operLogic":"and",
               "dataPointName":"温度",
               "highValue":"80",
               "lowValue":"1"
           },{
               "operLogic":"or",
               "dataPointName":"压力",
               "highValue":"180",
               "lowValue":"10"
           }
       ]
   }
   ```

   

6. 返回示例

   ```json
   {
       "success": true,
       "msg": "添加成功",
       "obj": null
   }
   ```

7. 返回参数说明

   | 字段名  | 类型    | 说明                       |
   | ------- | ------- | -------------------------- |
   | success | boolean | 操作成功为true,失败为false |
   | msg     | String  | 用来记录操作是否成功的提示 |

### b. 删除场景

1. 简要描述

   删除单个场景模型，并删除该场景所使用的规则

2. 请求url

   ```
   175.27.245.91/model/scene/{id}
   ```

3. 请求方式

   delete

4. 参数

   | 参数名 | 必选 | 类型    | 说明                              |
   | ------ | ---- | ------- | --------------------------------- |
   | id     | 是   | Integer | 后端通过@PathVariable注解接收参数 |

   

5. 参数示例

   ```json
   175.27.245.91/model/scene/1
   ```

   

6. 返回示例

   ```json
   {
       "success": true,
       "msg": "删除成功",
       "obj": null
   }
   ```

7. 返回参数说明

   | 字段名  | 类型    | 说明                       |
   | ------- | ------- | -------------------------- |
   | success | boolean | 操作成功为true,失败为false |
   | msg     | String  | 用来记录操作是否成功的提示 |

### c. 修改场景

1. 简要描述

   修改单个场景

   修改t_scene表后，再把该场景的相关规则根据场景id从t_rule中删除，再添加该场景的新规则

2. 请求url

   ```
   175.27.245.91/model/scene
   ```

3. 请求方式

   put

4. 参数

   | 参数名 | 必选 | 类型               | 说明                                     |
   | ------ | ---- | ------------------ | ---------------------------------------- |
   | s      | 是   | @RequestBody Scene | 前端传JSON对象，后端使用@RequestBody接收 |

   

5. 参数示例

   ```json
   {
       "id":"1",
       "sceneNumber":"场景1",
       "sceneName":"场景名1",
       "alarmTitle":"报警标题01",
       "alarmMsg":"报警消息01",
       "o":{"id":"1"},
       "rules":[
           {
               "id":"1",
               "operLogic":"and",
               "dataPointName":"温度",
               "highValue":"70",
               "lowValue":"1",
               "scene_id":1  #注意，必须携带上场景的id
           },{
               "id":"2",
               "operLogic":"or",
               "dataPointName":"压力",
               "highValue":"120",
               "lowValue":"10",
               "scene_id":1
           }
       ]
   }
   ```

   

6. 返回示例

   ```json
   {
       "success": true,
       "msg": "修改成功",
       "obj": null
   }
   ```

7. 返回参数说明

   | 字段名  | 类型    | 说明                       |
   | ------- | ------- | -------------------------- |
   | success | boolean | 操作成功为true,失败为false |
   | msg     | String  | 用来记录操作是否成功的提示 |

### d. 查询设备

1. 简要描述

   查询所有场景模型或根据关键字查询

2. 请求url

   ```
   175.27.245.91/model/scene?key=key&&pageNo=1
   ```

3. 请求方式

   get

4. 参数

   | 参数名 | 必选 | 类型   | 说明                        |
   | ------ | ---- | ------ | --------------------------- |
   | pageNo | 是   | int    | 分页的页码                  |
   | key    | 否   | String | 查询关键字,会从多个字段查询 |

5. 返回示例

   ```json
   {
       "success": true,
       "msg": null,
       "obj": {
           "total": 2,
           "list": [
               {
                   "id": 1,
                   "sceneNumber": "场景1",
                   "sceneName": "场景名1",
                   "alarmTitle": "报警标题01",
                   "alarmMsg": "报警消息01",
                   "o": {
                       "id": 1,
                       "name": "南京煤业有限公司",
                       "parentOrga": null,
                       "orgaType": null,
                       "location": null,
                       "orga_number": null,
                       "ext": null
                   },
                   "rules": [
                       {
                           "id": 13,
                           "operLogic": "and",
                           "dataPointName": "温度",
                           "highValue": 70,
                           "lowValue": 1,
                           "scene_id": null
                       },
                       {
                           "id": 14,
                           "operLogic": "or",
                           "dataPointName": "压力",
                           "highValue": 120,
                           "lowValue": 10,
                           "scene_id": null
                       }
                   ]
               }
           ],
           "pageNum": 1,
           "pageSize": 2,
           "size": 1,
           "startRow": 1,
           "endRow": 1,
           "pages": 1,
           "prePage": 0,
           "nextPage": 0,
           "isFirstPage": true,
           "isLastPage": true,
           "hasPreviousPage": false,
           "hasNextPage": false,
           "navigatePages": 8,
           "navigatepageNums": [
               1
           ],
           "navigateFirstPage": 1,
           "navigateLastPage": 1,
           "lastPage": 1,
           "firstPage": 1
       }
   }
   ```

6. 返回参数说明

   | 字段名  | 类型     | 说明                       |
   | ------- | -------- | -------------------------- |
   | success | boolean  | 操作成功为true,失败为false |
   | msg     | String   | 用来记录操作的错误提示     |
   | obj     | PageInfo | 分页对象                   |

# 四、资产管理

## 1. 传感器管理

### a. 添加传感器

1. 简要描述

   添加单个传感器

2. 请求url

   ```
   175.27.245.91/asset/sensor
   ```

3. 请求方式

   post

4. 参数

   | 参数名 | 必选 | 类型                       | 说明                                     |
   | ------ | ---- | -------------------------- | ---------------------------------------- |
   | sensor | 是   | @RequestBody Sensor sensor | 前端传JSON对象，后端使用@RequestBody接收 |

   

5. 参数示例

   ```json
   {
       "sensorName":"传感器名1",
       "sensorCode":"传感器编码1",
       "protocal":"传感器协议",
       "sensorModel":{"id":"1"},
       "item":{"id":"1"}
   }
   ```
   
   
   
6. 返回示例

   ```json
   {
       "success": true,
       "msg": "添加成功",
       "obj": null
   }
   ```

7. 返回参数说明

   | 字段名  | 类型    | 说明                       |
   | ------- | ------- | -------------------------- |
   | success | boolean | 操作成功为true,失败为false |
   | msg     | String  | 用来记录操作是否成功的提示 |

### b. 删除传感器

1. 简要描述

   删除单个传感器

2. 请求url

   ```
   175.27.245.91/asset/sensor/{id}
   ```

3. 请求方式

   delete

4. 参数

   | 参数名 | 必选 | 类型    | 说明                              |
   | ------ | ---- | ------- | --------------------------------- |
   | id     | 是   | Integer | 后端通过@PathVariable注解接收参数 |

   

5. 参数示例

   ```json
   175.27.245.91/asset/sensor/1
   ```

   

6. 返回示例

   ```json
   {
       "success": true,
       "msg": "删除成功",
       "obj": null
   }
   ```

7. 返回参数说明

   | 字段名  | 类型    | 说明                       |
   | ------- | ------- | -------------------------- |
   | success | boolean | 操作成功为true,失败为false |
   | msg     | String  | 用来记录操作是否成功的提示 |

### c. 修改传感器

1. 简要描述

   修改单个传感器

2. 请求url

   ```
   175.27.245.91/asset/sensor
   ```

3. 请求方式

   put

4. 参数

   | 参数名 | 必选 | 类型                | 说明                                     |
   | ------ | ---- | ------------------- | ---------------------------------------- |
   | sensor | 是   | @RequestBody Sensor | 前端传JSON对象，后端使用@RequestBody接收 |

   

5. 参数示例

   ```json
   {
       "id":"5",
       "sensorName":"传感器名5",
       "sensorCode":"传感器编码3",
       "protocal":"传感器协议3",
       "sensorModel":{"id":"1"},
       "item":{"id":"2"}
   }
   ```
   
   

6. 返回示例

   ```json
   {
       "success": true,
       "msg": "修改成功",
       "obj": null
   }
   ```

7. 返回参数说明

   | 字段名  | 类型    | 说明                       |
   | ------- | ------- | -------------------------- |
   | success | boolean | 操作成功为true,失败为false |
   | msg     | String  | 用来记录操作是否成功的提示 |



### d. 查询传感器

1. 简要描述

   查询所有传感器或根据关键字查询

2. 请求url

   ```
   175.27.245.91/asset/sensor?key=key&&pageNo=1
   ```

3. 请求方式

   get

4. 参数

   | 参数名 | 必选 | 类型   | 说明                        |
   | ------ | ---- | ------ | --------------------------- |
   | pageNo | 是   | int    | 分页的页码                  |
   | key    | 否   | String | 查询关键字,会从多个字段查询 |

5. 返回示例

   ```json
   {
       "success": true,
       "msg": null,
       "obj": {
           "total": 1,
           "list": [
               {
                   "id": 1,
                   "sensorName": "传感器名3",
                   "sensorCode": "传感器编码3",
                   "protocal": "传感器协议3",
                   "sensorModel": {
                       "id": 2,
                       "deviceName": "设备名1",
                       "deviceType": "温度传感器",
                       "deviceNumber": null,
                       "createTime": null,
                       "protocol": null,
                       "upInterval": null,
                       "dataPointName": null,
                       "dataPointExtra": null,
                       "lowThreshold": 50,
                       "highThreshold": 80
                   },
                   "item": {
                       "id": 2,
                       "name": "神话二号项目",
                       "number": null,
                       "o": {
                           "id": 1,
                           "name": "南京煤业有限公司",
                           "parentOrga": null,
                           "orgaType": null,
                           "location": null,
                           "orga_number": null,
                           "ext": null
                       },
                       "addr": null,
                       "phone": null,
                       "createTime": null
                   }
               }
           ],
           "pageNum": 1,
           "pageSize": 2,
           "size": 1,
           "startRow": 1,
           "endRow": 1,
           "pages": 1,
           "prePage": 0,
           "nextPage": 0,
           "isFirstPage": true,
           "isLastPage": true,
           "hasPreviousPage": false,
           "hasNextPage": false,
           "navigatePages": 8,
           "navigatepageNums": [
               1
           ],
           "navigateFirstPage": 1,
           "navigateLastPage": 1,
           "lastPage": 1,
           "firstPage": 1
       }
   }
   ```
   
6. 返回参数说明

   | 字段名  | 类型     | 说明                       |
   | ------- | -------- | -------------------------- |
   | success | boolean  | 操作成功为true,失败为false |
   | msg     | String   | 用来记录操作的错误提示     |
   | obj     | PageInfo | 分页对象                   |





## 2. 管道管理

### a. 添加管道

1. 简要描述

   添加单个管道

2. 请求url

   ```
   175.27.245.91/asset/pipe
   ```

3. 请求方式

   post

4. 参数

   | 参数名  | 必选 | 类型                         | 说明                                     |
   | ------- | ---- | ---------------------------- | ---------------------------------------- |
   | product | 是   | @RequestBody Product product | 前端传JSON对象，后端使用@RequestBody接收 |

   

5. 参数示例

   ```json
   {
       "productName":"产品名1",
       "productCode":"产品编码1",
       "manuDate":"2021-10-01 12:13:53",
       "productDate":"2021-10-04 12:13:53",
       "pipeModel":{"id":"1"},
       "item":{"id":"1"},
       "sensor":{"id":"1"}
   }
   ```
   
   
   
6. 返回示例

   ```json
   {
       "success": true,
       "msg": "添加成功",
       "obj": null
   }
   ```

7. 返回参数说明

   | 字段名  | 类型    | 说明                       |
   | ------- | ------- | -------------------------- |
   | success | boolean | 操作成功为true,失败为false |
   | msg     | String  | 用来记录操作是否成功的提示 |

### b. 删除管道

1. 简要描述

   删除单个管道

2. 请求url

   ```
   175.27.245.91/asset/pipe/{id}
   ```

3. 请求方式

   delete

4. 参数

   | 参数名 | 必选 | 类型    | 说明                              |
   | ------ | ---- | ------- | --------------------------------- |
   | id     | 是   | Integer | 后端通过@PathVariable注解接收参数 |

   

5. 参数示例

   ```json
   175.27.245.91/asset/pipe/1
   ```

   

6. 返回示例

   ```json
   {
       "success": true,
       "msg": "删除成功",
       "obj": null
   }
   ```

7. 返回参数说明

   | 字段名  | 类型    | 说明                       |
   | ------- | ------- | -------------------------- |
   | success | boolean | 操作成功为true,失败为false |
   | msg     | String  | 用来记录操作是否成功的提示 |

### c. 修改管道

1. 简要描述

   修改单个管道

2. 请求url

   ```
   175.27.245.91/asset/pipe
   ```

3. 请求方式

   put

4. 参数

   | 参数名  | 必选 | 类型              | 说明                                     |
   | ------- | ---- | ----------------- | ---------------------------------------- |
   | product | 是   | @RequestBody Pipe | 前端传JSON对象，后端使用@RequestBody接收 |

   

5. 参数示例

   ```json
   {
       "id":"4",
       "productName":"产品名4",
       "productCode":"产品编码2",
       "manuDate":"2022-9-01 12:13:53",
       "productDate":"2021-10-04 12:13:53",
       "PipeModel":{"id":"1"},
       "item":{"id":"1"},
       "sensor":{"id":"1"}
   }
   ```
   
   
   
6. 返回示例

   ```json
   {
       "success": true,
       "msg": "修改成功",
       "obj": null
   }
   ```

7. 返回参数说明

   | 字段名  | 类型    | 说明                       |
   | ------- | ------- | -------------------------- |
   | success | boolean | 操作成功为true,失败为false |
   | msg     | String  | 用来记录操作是否成功的提示 |

### d. 查询管道

1. 简要描述

   查询所有管道或根据关键字查询

2. 请求url

   ```
   175.27.245.91/asset/pipe?key=key&&pageNo=1
   ```

3. 请求方式

   get

4. 参数

   | 参数名 | 必选 | 类型   | 说明                        |
   | ------ | ---- | ------ | --------------------------- |
   | pageNo | 是   | int    | 分页的页码                  |
   | key    | 否   | String | 查询关键字,会从多个字段查询 |

5. 返回示例

   ```json
   {
       "success": true,
       "msg": null,
       "obj": {
           "total": 1,
           "list": [
               {
                   "id": 1,
                   "productName": "产品名01",
                   "productCode": "产品编码01",
                   "manuDate": "2021-09-01 12:13:53",
                   "productDate": "2021-10-04 12:13:53",
                   "pipeModel": {
                       "id": 1,
                       "pipeName": "管道名01",
                       "pipeNumber": null,
                       "pipeType": null,
                       "pipeIntroduce": null,
                       "pipePic": null,
                       "pipeManual": null,
                       "createTime": null
                   },
                   "item": {
                       "id": 2,
                       "name": "神话二号项目",
                       "number": null,
                       "o": {
                           "id": 2,
                           "name": "北京地铁公司",
                           "parentOrga": null,
                           "orgaType": null,
                           "location": null,
                           "orga_number": null,
                           "ext": null
                       },
                       "addr": null,
                       "phone": null,
                       "createTime": null
                   },
                   "sensor": {
                       "id": 1,
                       "sensorName": "传感器名3",
                       "sensorCode": null,
                       "protocal": null,
                       "sensorModel": null,
                       "item": null
                   }
               }
           ],
           "pageNum": 1,
           "pageSize": 2,
           "size": 1,
           "startRow": 1,
           "endRow": 1,
           "pages": 1,
           "prePage": 0,
           "nextPage": 0,
           "isFirstPage": true,
           "isLastPage": true,
           "hasPreviousPage": false,
           "hasNextPage": false,
           "navigatePages": 8,
           "navigatepageNums": [
               1
           ],
           "navigateFirstPage": 1,
           "navigateLastPage": 1,
           "firstPage": 1,
           "lastPage": 1
       }
   }
   ```
   
6. 返回参数说明

   | 字段名  | 类型     | 说明                       |
   | ------- | -------- | -------------------------- |
   | success | boolean  | 操作成功为true,失败为false |
   | msg     | String   | 用来记录操作的错误提示     |
   | obj     | PageInfo | 分页对象                   |

# 五、报警管理

## 1. 添加报警信息

1. 简要描述

   添加单个报警信息，只用来后端测试，前端功能页面用不着，s

   **后端同学要注意**:

   + 添加报警信息的传感器id必须在数据库中存在。

   + 报警信息在插入到数据库时，同一个传感器只能插入一条报警信息，如果在插入报警信息时，传感器id重复，则不再插入，变成修改。

   + 参考sql

     ```sql
     insert into
     	t_alarm(sensor_id, currentValue, alarmMsg)
     VALUES
         (#{sensor.id},#{currentValue},#{alarmMsg})
     on duplicate key update
      	currentValue=#{currentValue},alarmMsg=#{alarmMsg},alarmTime=now()
     ```

     

2. 请求url

   ```
   175.27.245.91/alarm/alarm
   ```

3. 请求方式

   post

4. 参数

   | 参数名  | 必选 | 类型                     | 说明                                     |
   | ------- | ---- | ------------------------ | ---------------------------------------- |
   | product | 是   | @RequestBody Alarm alarm | 前端传JSON对象，后端使用@RequestBody接收 |

   

5. 参数示例

   ```json
   {
       "sensor": {
           "id": 1,
           "sensorModel": {"id": 2}
       },
       "currentValue": 91,
       "alarmMsg": "温度传感器:当前值太高",
       "isHandled": true,
       "alarmTime": "2021-10-24T08:57:51.000+0000"
   }
   ```

   

6. 返回示例

   ```json
   {
       "success": true,
       "msg": "添加成功",
       "obj": null
   }
   ```

7. 返回参数说明

   | 字段名  | 类型    | 说明                       |
   | ------- | ------- | -------------------------- |
   | success | boolean | 操作成功为true,失败为false |
   | msg     | String  | 用来记录操作是否成功的提示 |

## 2. 查询报警

1. 简要描述

   查询所有报警信息或根据关键字查询，注意，在后端接收参数时，要给日期参数添加注解DateTimeFormat，用来把前端传来的字符串转日期

2. 请求url

   ```
   175.27.245.91/alarm/alarm?key=key&&pageNo=1
   
   ```

3. 请求方式

   get

4. 参数

   | 参数名 | 必选 | 类型    | 说明                |
   | ------ | ---- | ------- | ------------------- |
   | pageNo | 是   | int     | 分页的页码          |
   | key    | 否   | boolean | 是否处理过          |
   | from   | 否   | Date    | 从from日期开始查找  |
   | end    | 否   | Date    | 到end日期为截止日期 |

5. 返回示例

   ```json
   {
       "success": true,
       "msg": null,
       "obj": {
           "total": 613,
           "list": [
               {
                   "id": 2843,
                   "sensor": {
                       "id": 4,
                       "sensorName": "传感器名1",
                       "sensorCode": null,
                       "protocal": null,
                       "sensorModel": {
                           "id": 1,
                           "deviceName": null,
                           "deviceType": null,
                           "deviceNumber": null,
                           "createTime": null,
                           "protocol": null,
                           "upInterval": null,
                           "dataPointName": "压力",
                           "dataPointExtra": null,
                           "lowThreshold": null,
                           "highThreshold": null,
                           "o": null
                       },
                       "item": null,
                       "o": null
                   },
                   "currentValue": 87,
                   "alarmMsg": "压力传感器:当前值太高",
                   "alarmTime": "2021-10-25 11:04:36",
                   "handled": true
               },
               {
                   "id": 2846,
                   "sensor": {
                       "id": 4,
                       "sensorName": "传感器名1",
                       "sensorCode": null,
                       "protocal": null,
                       "sensorModel": {
                           "id": 1,
                           "deviceName": null,
                           "deviceType": null,
                           "deviceNumber": null,
                           "createTime": null,
                           "protocol": null,
                           "upInterval": null,
                           "dataPointName": "压力",
                           "dataPointExtra": null,
                           "lowThreshold": null,
                           "highThreshold": null,
                           "o": null
                       },
                       "item": null,
                       "o": null
                   },
                   "currentValue": 64,
                   "alarmMsg": "压力传感器:当前值太高",
                   "alarmTime": "2021-10-25 11:04:47",
                   "handled": false
               }
           ],
           "pageNum": 100,
           "pageSize": 2,
           "size": 2,
           "startRow": 199,
           "endRow": 200,
           "pages": 307,
           "prePage": 99,
           "nextPage": 101,
           "isFirstPage": false,
           "isLastPage": false,
           "hasPreviousPage": true,
           "hasNextPage": true,
           "navigatePages": 8,
           "navigatepageNums": [
               96,
               97,
               98,
               99,
               100,
               101,
               102,
               103
           ],
           "navigateFirstPage": 96,
           "navigateLastPage": 103,
           "firstPage": 96,
           "lastPage": 103
       }
   }
   ```

6. 返回参数说明

   | 字段名  | 类型     | 说明                       |
   | ------- | -------- | -------------------------- |
   | success | boolean  | 操作成功为true,失败为false |
   | msg     | String   | 用来记录操作的错误提示     |
   | obj     | PageInfo | 分页对象                   |

## 3. 修改报警

1. 简要描述

   修改单个报警的处理状态

2. 请求url

   ```
   175.27.245.91/alarm/alarm
   ```

3. 请求方式

   put

4. 参数

   | 参数名 | 必选 | 类型               | 说明                                     |
   | ------ | ---- | ------------------ | ---------------------------------------- |
   | a      | 是   | @RequestBody Alarm | 前端传JSON对象，后端使用@RequestBody接收 |

   

5. 参数示例

   ```json
   {
       "id":2843,
       "isHandled":true
   }
   ```

   

6. 返回示例

   ```json
   {
       "success": true,
       "msg": "修改成功",
       "obj": null
   }
   ```

7. 返回参数说明

   | 字段名  | 类型    | 说明                       |
   | ------- | ------- | -------------------------- |
   | success | boolean | 操作成功为true,失败为false |
   | msg     | String  | 用来记录操作是否成功的提示 |

# 六 管道监测

## 1. 实时监测

1. 简要描述

   查询所有项目的实时信息

   **前端同学注意：**

   1. 进入前端页面，就应自动发送websocket请求，从而接收所有项目的实时上报信息
   2. 如果仅仅显示指定项目的信息，则传该项目的id

   **后端同学注意：**

   + 配置类上

       ```java
       @Bean//目的是告诉spring,要扫描带有@ServerEndpoint注解的类
       public ServerEndpointExporter serverEndpointExporter() {
         return new ServerEndpointExporter();
       }
       ```

   + 业务类上添加注解：@ServerEndpoint( "/monitor")用来监听连接

     ```java
     @OnOpen//连接建立成功自动调用的方法
     @OnMessage//收到客户端消息后自动调用的方法,message为客户端发送过来的消息
     @OnClose//连接关闭调用的方法
     @KafkaListener(topics="alarm",groupId = "gr02")//监听kafka消息事件
     ```

   + 微服务网关配置

     ```yaml
     - id: monitor-manager
         uri: lb:ws://monitor-manager
         predicates:
         	- Path=/monitor/**
     ```

   + 定义一个Map用来保存所有websocket会话连接
   + 定义一个map用来保存所有项目的消息，可考虑使用redis实现

2. 请求url

   ```
   socket = new WebSocket("ws://175.27.245.91/monitor");  显示所有项目信息，进入页面就应该执行该请求
   socket.send("项目id"); 在上面已经连接的情况下，发送项目id
   ```

3. 请求方式

   websocket

4. 参数

   无

5. 返回示例

   ```json
   {
       1: {
           "alarmMsg": "温度传感器:正常",
           "currentValue": 58,
           "handled": false,
           "normal": true, 
           "sensor": {
               "id": 1,
               "item": {
                   "id": 2,
                   "name": "神话二号项目",
                   "o": {
                       "id": 1,
                       "name": "南京煤业有限公司"
                   }
               },
               "protocal": "传感器协议3",
               "sensorCode": "传感器编码3",
               "sensorModel": {
                   "deviceName": "设备名1",
                   "deviceType": "温度传感器",
                   "highThreshold": 80,
                   "id": 2,
                   "lowThreshold": 50
               },
               "sensorName": "传感器名3"
           }
       },
       5: {
           "alarmMsg": "压力传感器:当前值太高",
           "currentValue": 80,
           "handled": false,
           "normal": false,
           "sensor": {
               "id": 5,
               "item": {
                   "id": 2,
                   "name": "神话二号项目",
                   "o": {
                       "id": 1,
                       "name": "南京煤业有限公司"
                   }
               },
               "protocal": "传感器协议3",
               "sensorCode": "传感器编码3",
               "sensorModel": {
                   "deviceName": "设备名2",
                   "deviceType": "压力传感器",
                   "highThreshold": 50,
                   "id": 1,
                   "lowThreshold": 25
               },
               "sensorName": "传感器名5"
           }
       }
   }
   ```

6. 返回参数说明

   返回值为map类型

   | 字段名 | 类型  | 说明     |
   | ------ | ----- | -------- |
   | key    | int   | 传感器id |
   | value  | Alarm | 报警消息 |

## 2.历史监测

同上，在后端实现上，调整kafka参数，实现过去信息的显示。
