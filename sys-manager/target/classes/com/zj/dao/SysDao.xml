<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zj.dao.SysDao">
<<<<<<< HEAD
    <select id="userSelect" resultType="com.zj.entity.User">
    select id ,username,realname as realName,password,salt,
    avatar,birthday,sex,email,phone,
    org_code as orgCode,work_no as workNo,post
    from sys_user where username = #{username} and password = #{password}
=======
    <resultMap id="user_map" type="com.zj.entity.UserManager">
<!--        用户信息-->
        <id column="id" property="id"/>
        <result column="username" property="username"/>
        <result column="password" property="password"/>
        <result column="salt" property="salt"/>
        <result column="phone" property="phone"/>
<!--        用户所在的公司-->
        <association property="o" javaType="com.zj.entity.Organize">
            <id column="id" property="id"/>
            <result column="orgname" property="name"/>
        </association>
<!--       用户____> 角色表____>角色实体集 -->
        <collection property="roles" ofType="com.zj.entity.Role">
            <result column="rolename" property="name"/>
            <result column="ext" property="ext"/>
<!--         角色表____>权限表_____>权限实体集-->
            <collection  property="perms" ofType="com.zj.entity.Perm">
                <result column="permname" property="name"/>
            </collection>
        </collection>
    </resultMap>
    <select id="userSelect" resultMap="user_map">
        SELECT
            u.id,
            u.username,
            u.password,
            u.salt,
            u.phone,
            o.NAME AS organame,
            r.NAME AS rolename,
            r.ext,
            p.NAME AS permname
        FROM
            t_user u
            LEFT JOIN organize o ON o.id = u.orga_id
            LEFT JOIN t_user_role ur ON ur.userid = u.id
            LEFT JOIN t_role r ON r.id = ur.roleid
            LEFT JOIN t_role_perms rp ON rp.role_id = r.id
            LEFT JOIN t_perms p ON p.id = rp.perm_id
        where
            u.username = #{username} and  u.password= #{password}
>>>>>>> 41fb7b8879d00dd530b7ffd5f0a57d89590d94dc
    </select>
</mapper>